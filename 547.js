"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[547],{7210:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"1324a012423cd2d7eb903c9a88d60aff.svg"},7547:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var i=n(2735),o=n(6949),a=n(9496),s=n(2773),r=n(2998),u=n(681);function l(e,t){const[n,i]=a.useState([t]),o=(0,u.Z)();return a.useEffect((()=>{const t=e=>{i([e]),o()};return r.Z.on(e,t),()=>{r.Z.off(e,t)}}),[]),n[0]}const c={};function p(e,t=(()=>{}),n){a.useEffect((()=>(c[e]=c[e]||0,c[e]++,1===c[e]&&(s.ZP.subscriptions.push(e),s.ZP.updateSubscriptions()),r.Z.on(e,t),()=>{r.Z.off(e,t),c[e]--,0===c[e]&&(delete c[e],s.ZP.subscriptions.splice(s.ZP.subscriptions.indexOf(e),1),s.ZP.updateSubscriptions(),n&&n())})),[])}let d=null;var y,m=n(3386),f=n(5835),g=n(3614),h=n(1714),Z=n(1539),b=n(6e3),T=n(2649),x=n(9456),v=n(150);!function(e){e.MAINNET="MAINNET",e.TESTNET="TESTNET",e.DEBUG="DEBUG"}(y||(y={}));const w=new class{getNetwork(){return y.MAINNET}};var C=n(5054);const E=new C.Client((S=w.getNetwork(),{[y.MAINNET]:"https://node-vite.thomiz.dev/http",[y.TESTNET]:"https://buidl.vite.net/gvite/http",[y.DEBUG]:"http://127.0.0.1:23456"}[S])),P="vite_c4143df0d4f24b222cde922164ccb573cd57b7e3a027186b3b",M=[{inputs:[{internalType:"uint256",name:"sizex",type:"uint256"},{internalType:"uint256",name:"sizey",type:"uint256"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"x",type:"uint256"},{indexed:!1,internalType:"uint256",name:"y",type:"uint256"}],name:"CanvasSizeChange",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"hexColor",type:"uint256"},{indexed:!0,internalType:"uint256",name:"colorCode",type:"uint256"}],name:"NewColor",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"uint256",name:"x",type:"uint256"},{indexed:!0,internalType:"uint256",name:"y",type:"uint256"},{indexed:!1,internalType:"uint256",name:"color",type:"uint256"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"PixelChange",type:"event"},{inputs:[{internalType:"uint256",name:"hexColor",type:"uint256"}],name:"addColor",outputs:[{internalType:"uint256",name:"colorCode",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"addDefaultColors",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"getCanvasSize",outputs:[{internalType:"uint256",name:"x",type:"uint256"},{internalType:"uint256",name:"y",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"colorCode",type:"uint256"}],name:"getColor",outputs:[{internalType:"bool",name:"exists",type:"bool"},{internalType:"uint256",name:"hexColor",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"x",type:"uint256"},{internalType:"uint256",name:"y",type:"uint256"}],name:"getPixel",outputs:[{internalType:"uint256",name:"colorCode",type:"uint256"},{internalType:"uint256",name:"hexColor",type:"uint256"},{internalType:"address",name:"owner",type:"address"},{internalType:"uint256",name:"timestamp",type:"uint256"},{internalType:"bytes32",name:"hash",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"x",type:"uint256"},{internalType:"uint256",name:"y",type:"uint256"}],name:"increaseCanvasSize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"x",type:"uint256"},{internalType:"uint256",name:"y",type:"uint256"},{internalType:"uint256",name:"color",type:"uint256"}],name:"placePixel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"setOwner",outputs:[],stateMutability:"nonpayable",type:"function"}];var S;new C.Contract(E,P,M);var k=n(873),N=n(255);const z=(0,m.createUseGesture)([f.e,f.f]),A=64;function B(e){(0,a.useEffect)((()=>{const e=e=>e.preventDefault();return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),()=>{document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]);const t=(0,a.useRef)(),[n,o]=(0,a.useState)(null),[s,r]=(0,g.useSpring)((()=>{const t=e.size.x*A+100,n=e.size.y*A+200;let i=1;window.innerHeight-64<n&&(i=Math.floor((window.innerHeight-64)/n*100)/100),window.innerWidth<t*i&&(i=Math.floor(window.innerWidth/t*100)/100);const o=e.size.x*A,a=e.size.y*A;return{x:Math.round((window.innerWidth-o)/2),y:Math.round((window.innerHeight-64-a)/2),scale:i,rotateZ:0}}));return z({onDrag:({pinching:e,cancel:t,offset:[n,i]})=>{if(e)return t();r.start({x:n,y:i})},onPinch:({origin:[e,n],first:i,movement:[o],offset:[a],memo:u})=>{if(i){const{width:i,height:o,x:a,y:r}=t.current.getBoundingClientRect(),l=e-(a+i/2),c=n-(r+o/2);u=[s.x.get(),s.y.get(),l,c]}const l=u[0]-(o-1)*u[2],c=u[1]-(o-1)*u[3];return r.start({scale:a,rotateZ:0,x:l,y:c}),u}},{target:t,drag:{from:()=>[s.x.get(),s.y.get()]},pinch:{scaleBounds:{min:.5,max:2},rubberband:!0}}),(0,i.tZ)("div",{ref:t,css:{display:"block",height:"calc(100vh - 64px)",overflow:"hidden",width:"100%",userSelect:"none",touchAction:"manipulation"}},(0,i.tZ)(g.animated.div,{ref:t,style:s},(0,i.tZ)(O,Object.assign({},e,{getZoom:()=>s.scale.get(),select:n,setSelect:e=>{const t=Math.round(-e[0]*A+window.innerWidth/2),n=Math.round(-e[1]*A+window.innerHeight/2-128);r.start({scale:1,x:t,y:n}),o(e)}}))),(0,i.tZ)("div",{style:{display:!n||e.readonly?"none":"initial"}},(0,i.tZ)(D,{select:n,colors:e.colors})))}function D(e){const t=(0,k.Z)(),[n,o]=(0,a.useState)(!1),[s,r]=(0,a.useState)(0);if(!e.select)return null;const u=(0,i.tZ)("div",{css:{display:"flex",flexDirection:"column",marginTop:20,alignItems:"center",gap:20,marginLeft:20,marginRight:20}},(0,i.tZ)("div",{css:{display:"flex",flexDirection:"row",gap:10,flexWrap:"wrap",justifyContent:"center"}},e.colors.map(((e,t)=>(0,i.tZ)("div",{css:{backgroundColor:e,width:50,height:50,cursor:"pointer",transition:"border-radius 0.2s"},style:{borderRadius:s===t?"50%":8},onClick:e=>{e.stopPropagation(),r(t)}})))),(0,i.tZ)("div",null,(0,i.tZ)(Z.Z,{variant:"outlined",onClick:async()=>{if(b.ZP.ready){const t=v.accountBlock.createAccountBlock("callContract",{address:b.ZP.accounts[0],abi:M,methodName:"placePixel",tokenId:v.constant.Vite_TokenId,amount:"0",toAddress:P,params:[...e.select,s]});(0,x.C)("Please accept the transaction on your phone!",{type:"info",timeout:3e3,icon:!0});try{await b.ZP.sendTransactionAsync({block:t.accountBlock})}catch(e){console.error(e),(0,x.C)(`${e.name||e.error.code}: ${e.message||e.error.message}`,{type:"error",timeout:5e3,icon:!0})}(0,x.C)("Pixel Placed!",{type:"success",timeout:1e3,icon:!0})}else(0,T.l)()}},"Place Pixel")));return t?(0,i.tZ)("div",{css:{position:"absolute",bottom:0}},n?null:(0,i.tZ)("div",{css:{backgroundColor:h.Z.palette.secondary.main,paddingTop:10,paddingBottom:10,width:"100vw",display:"flex",justifyContent:"center"}},(0,i.tZ)(Z.Z,{variant:"outlined",onClick:()=>{o(!0)}},"Place Pixel")),(0,i.tZ)(N.Z,{isOpen:n,onClose:()=>o(!1),css:{"& > .react-modal-sheet-container":{backgroundColor:h.Z.palette.secondary.main+"!important"},"& > .react-modal-sheet-backdrop":{backgroundColor:"rgba(0, 0, 0, 0.3)!important"},"& > .react-modal-sheet-drag-indicator":{backgroundColor:"#666!important"}},snapPoints:[480,0]},(0,i.tZ)(N.Z.Container,null,(0,i.tZ)(N.Z.Header,null),(0,i.tZ)(N.Z.Content,null,(0,i.tZ)("div",{css:{backgroundColor:h.Z.palette.secondary.main}},u))),(0,i.tZ)(N.Z.Backdrop,null))):(0,i.tZ)("div",{css:{position:"absolute",top:window.innerHeight-200,height:200,width:"100%",backgroundColor:h.Z.palette.secondary.main}},u)}function O(e){const[,t]=(0,a.useState)(!1),[o,r]=(0,a.useState)(null),{loaded:c,pixels:y}=function(){const e=(0,u.Z)(),t=l("WS_STATE",s.ZP.state);return a.useEffect((()=>{t!==s.e4.OPEN&&(d=null)}),[t]),p("pixels",(t=>{d=t,e()}),(()=>{d=null})),{loaded:!!d,pixels:d}}(),m=function(e){const t=(0,a.useRef)();return(0,a.useEffect)((()=>{t.current=e})),t.current}(y),f=(0,a.useRef)();return(0,a.useEffect)((()=>{var t;const n=f.current;if(!n||!c)return;const i=n.getContext("2d");for(let n=0;n<y.length;n++){const o=y[n];for(let a=0;a<o.length;a++){const s=o[a];s!=((null===(t=null==m?void 0:m[n])||void 0===t?void 0:t[a])||null)&&(i.fillStyle=e.colors[s]||e.colors[0],i.fillRect(n*A,a*A,A,A))}}}),[f.current,y,c]),(0,i.tZ)(a.Fragment,null,e.select&&(0,i.tZ)("img",{css:{position:"absolute",opacity:.6},style:{left:e.select[0]*A,top:e.select[1]*A},src:n(7210).Z,width:A,height:A,draggable:!1}),(0,i.tZ)("canvas",{ref:f,css:{width:e.size.x*A,height:e.size.y*A,cursor:"pointer"},width:e.size.x*A,height:e.size.y*A,onMouseDown:e=>{0===e.button&&(t(!0),r({x:e.pageX,y:e.pageY}))},onMouseUp:n=>{if(0===n.button&&(t(!1),Math.abs(o.x-n.pageX)+Math.abs(o.y-n.pageY)<5)){const t=n.target.getBoundingClientRect(),i=n.pageX-t.left,o=n.pageY-t.top,a=e.getZoom(),s=Math.floor(i/A/a),r=Math.floor(o/A/a);e.setSelect([s,r])}}}))}let R=null,W=null;function I(){const{loaded:e,colors:t}=function(){const e=(0,u.Z)(),t=l("WS_STATE",s.ZP.state);return a.useEffect((()=>{t!==s.e4.OPEN&&(W=null)}),[t]),p("colors",(t=>{W=t,e()}),(()=>{W=null})),{loaded:!!W,colors:W}}(),{loaded:n,size:r}=function(){const e=(0,u.Z)(),t=l("WS_STATE",s.ZP.state);return a.useEffect((()=>{t!==s.e4.OPEN&&(R=null)}),[t]),p("size",(t=>{R=t,e()}),(()=>{R=null})),{loaded:!!R,size:R}}();return n&&e?(0,i.tZ)(B,{readonly:!1,colors:t,size:r}):(0,i.tZ)(o.Z,null)}}}]);
//# sourceMappingURL=547.js.map